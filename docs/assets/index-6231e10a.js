(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const t of n.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&c(t)}).observe(document,{childList:!0,subtree:!0});function d(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(e){if(e.ep)return;e.ep=!0;const n=d(e);fetch(e.href,n)}})();const P=""+new URL("../size1.png",import.meta.url).href,_=""+new URL("../size2.png",import.meta.url).href,U=""+new URL("../legend1.png",import.meta.url).href,k=""+new URL("../legend2.png",import.meta.url).href,z=""+new URL("../newData1.png",import.meta.url).href,V=""+new URL("../newData2.png",import.meta.url).href,F=""+new URL("../bear1.png",import.meta.url).href,q=""+new URL("../bear2.png",import.meta.url).href;let E;async function L(){var x;const a=((x=document.querySelector('input[name="imageset"]:checked'))==null?void 0:x.value)??"legend";console.log("imageSet");let s=U,d=k;a==="size"?(s=P,d=_):a==="newData"?(s=z,d=V):a==="bear"&&(s=F,d=q);const c=document.getElementById("a"),e=new Image;e.src=s,await e.decode(),c.width=e.width,c.height=e.height;const n=c.getContext("2d");if(n===null)return;n.drawImage(e,0,0);const t=document.getElementById("b"),i=new Image;i.src=d,await i.decode(),t.width=e.width,t.height=e.height;const o=t.getContext("2d");if(o===null)return;o.fillStyle="white",o.fillRect(0,0,t.width,t.height),o.drawImage(i,0,0);const u=n.getImageData(0,0,c.width,c.height),r=cv.matFromImageData(u),h=o.getImageData(0,0,t.width,t.height),l=cv.matFromImageData(h);if(E===void 0){E=H(r,l);const O=document.getElementById("score");O!==null&&(O.innerText=E.toFixed(3))}const I=document.querySelector('input[name="contourType"]:checked').value,f=N(r,l,!0),p=N(l,r,!0);document.getElementById("contourArea");const m=-1,g=255;let w=.66;const y=new cv.Scalar(102,194,165,g),v=new cv.Scalar(240,82,104,g);I==="pixels"?(C(l,f.img,w,y),C(r,p.img,w,v),f.img.delete(),p.img.delete()):(T(l,f.contours,y,m,w,I),T(r,p.contours,v,m,w,I));const M=document.getElementById("transparency"),S=M!=null?parseFloat(M.value):0;let D=new cv.Mat;cv.addWeighted(l,.5+S,r,.5-S,0,D),cv.imshow("diff",D),document.getElementById("summary").innerText=`${p.contours.length} removed and ${f.contours.length} added regions.`,r.delete(),l.delete(),D.delete()}cv.getBuildInformation?L():(console.log("WASM"),cv.onRuntimeInitialized=()=>{L()});const R=document.getElementById("syncIterations"),b=document.getElementById("dilateIterations"),A=document.getElementById("erodeIterations");R.addEventListener("change",()=>{R.checked&&(A.value=b.value)});b.addEventListener("input",()=>{R.checked&&(A.value=b.value)});A.addEventListener("input",()=>{R.checked&&(b.value=A.value)});let B;[document.getElementById("dilateIterations"),document.getElementById("erodeIterations"),document.getElementById("contourArea"),document.getElementById("transparency"),document.getElementById("transparency"),...document.querySelectorAll('input[name="contourType"]'),...document.querySelectorAll('input[name="imageset"]')].forEach(a=>{a!==null&&a.addEventListener("input",s=>{s.target.name==="imageset"&&(E=void 0),B!==void 0&&clearTimeout(B),B=setTimeout(()=>{L(),B=void 0},700)})});function C(a,s,d,c){let e=a.clone();const n=s.data;for(let t=0;t<n.length;t+=1){const i=t*4;n[t]!==0&&(e.data[i]=c[0],e.data[i+1]=c[1],e.data[i+2]=c[2])}cv.addWeighted(e,d,a,1-d,0,a,-1)}function N(a,s,d){let c=new cv.Mat;cv.subtract(a,s,c);const e=new cv.Mat;cv.cvtColor(c,e,cv.COLOR_BGR2GRAY);const n=26,t=new cv.Mat;cv.threshold(e,t,n,255,cv.THRESH_BINARY),cv.imshow("mask",t);const i=cv.Mat.ones(3,3,cv.CV_8U),o=new cv.Mat;let u=document.getElementById("dilateIterations"),r=u!=null?parseInt(u.value):2;cv.dilate(t,o,i,new cv.Point(-1,-1),r,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.imshow("dilate",o);const h=new cv.Mat;if(u=document.getElementById("erodeIterations"),r=u!=null?parseInt(u.value):2,cv.erode(o,h,i,new cv.Point(-1,-1),r,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),cv.imshow("erode",h),c.delete(),e.delete(),t.delete(),i.delete(),o.delete(),!d)return{img:h,contours:[]};const l=new cv.MatVector,I=new cv.Mat;cv.findContours(h,l,I,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE),I.delete();const f=[];for(let m=0;m<l.size();m++){const g=l.get(m);f.push(cv.boundingRect(g))}const p=new Set;for(let m=0;m<f.length;m++){const g=f[m];let w=!1;for(let y=0;y<f.length;y++)if(m!==y){const v=f[y];if(v.x<=g.x&&v.y<=g.y&&v.x+v.width>=g.x+g.width&&v.y+v.height>=g.y+g.height){w=!0;break}}w?l.get(m).delete():p.add(l.get(m))}return l.delete(),{img:h,contours:Array.from(p)}}function H(a,s){const d=new cv.ORB,c=new cv.KeyPointVector,e=new cv.KeyPointVector,n=new cv.Mat,t=new cv.Mat,i=new cv.Mat;d.detectAndCompute(a,i,c,n),d.detectAndCompute(s,i,e,t);const o=new cv.BFMatcher(cv.NORM_HAMMING,!0),u=new cv.DMatchVector;o.match(n,t,u);let r=0;for(let l=0;l<u.size();l++)r+=u.get(l).distance;r/=u.size();const h=32*8;return r/=h,d.delete(),c.delete(),e.delete(),n.delete(),t.delete(),i.delete(),o.delete(),u.delete(),r}function T(a,s,d,c,e,n){let t=a.clone();for(const i of s){if(n==="rectangle"){const o=cv.boundingRect(i),u=new cv.Point(o.x,o.y),r=new cv.Point(o.x+o.width,o.y+o.height);cv.rectangle(t,u,r,d,c)}else if(n==="hull"){let o=new cv.Mat;cv.convexHull(i,o,!1,!0);let u=cv.LINE_8;const r=new cv.MatVector;r.push_back(o),cv.drawContours(t,r,0,d,c,u),r.delete()}else throw new Error(`Unknown contour type ${n}`);i.delete()}cv.addWeighted(t,e,a,1-e,0,a,-1),t.delete()}
